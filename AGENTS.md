# Codex Autorunner - Agent Guide

This repo dogfoods codex-autorunner to build itself. Read this before running the agent loop.

## Layout and key files
- Core package: `src/codex_autorunner/` (engine, CLI, server/API, UI assets).
- Runtime/config/state live under `.codex-autorunner/` (not at repo root):
  - Docs the agent reads/updates: `TODO.md`, `PROGRESS.md`, `OPINIONS.md`, `SPEC.md`, `SUMMARY.md`, `SNAPSHOT.md`.
  - When asked to update any of these docs, you MUST update the copies under `.codex-autorunner/`. Do not create new copies elsewhere.
  - Work doc intent (canonical):
    - TODO: ordered, high-level tasks for agents.
    - PROGRESS: work done + validation notes.
    - OPINIONS: constraints, style, and migration policies.
    - SPEC: source-of-truth requirements and scope.
    - SUMMARY: user-facing report + external/user actions.
    - SNAPSHOT: shareable repo brief (generated by `car snapshot`).
  - `ABOUT_CAR.md`: auto-generated quick reference for interactive sessions (regenerated if the marker is present).
  - Config: `.codex-autorunner/config.yml` (generated).
  - State/log: `.codex-autorunner/state.json`, `.codex-autorunner/codex-autorunner.log`, `.codex-autorunner/codex-server.log`, `.codex-autorunner/lock`.
  - Hub-only: `.codex-autorunner/manifest.yml`, `.codex-autorunner/hub_state.json`, `.codex-autorunner/codex-autorunner-hub.log`.
- Root defaults: `codex-autorunner.yml`; local overrides: `codex-autorunner.override.yml` (gitignored).
- Config precedence: built-ins < `codex-autorunner.yml` < override < `.codex-autorunner/config.yml` < env.

## CLI commands
- init/run/once/status/log/edit/doctor/resume/kill
- ingest-spec/clear-docs/snapshot/usage
- sessions/stop-session
- serve (API/UI)
- hub: `car hub serve|scan|create` (worktrees via UI/API)

## Safe updates (launchd mac hub)
- Preferred path: `scripts/safe-refresh-local-mac-hub.sh` (staged venv swap, launchd reload, `/health` + static/telegram checks, rollback on failure).
- `/system/update` and Telegram `/update` use the safe refresh script when available.
- Common overrides: `UPDATE_TARGET=web|telegram|both`, `HEALTH_CHECK_STATIC=auto|true|false`, `HEALTH_CHECK_TELEGRAM=auto|true|false`, `HEALTH_PATH`, `HEALTH_STATIC_PATH`.

## Debugging
- Telegram troubleshooting guide: `docs/ops/telegram-debugging.md`

## Dogfooding rules
- We sometimes develop codex-autorunner using itself.
- Note that `.codex-autorunner/` is auto-generated by the CLI tool.
